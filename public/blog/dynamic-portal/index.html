<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><link rel="apple-touch-icon" sizes="256x256" href="/blog/icons/icon-256x256.png?v=008654519ce705ac7bc44303a9014606"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml"/><link rel="shortcut icon" href="/blog/icons/icon-48x48.png?v=008654519ce705ac7bc44303a9014606"/><link rel="manifest" href="/blog/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/blog/icons/icon-48x48.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="72x72" href="/blog/icons/icon-72x72.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="96x96" href="/blog/icons/icon-96x96.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="144x144" href="/blog/icons/icon-144x144.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="192x192" href="/blog/icons/icon-192x192.png?v=008654519ce705ac7bc44303a9014606"/><meta name="generator" content="Gatsby 2.4.3"/><link rel="apple-touch-icon" sizes="384x384" href="/blog/icons/icon-384x384.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="512x512" href="/blog/icons/icon-512x512.png?v=008654519ce705ac7bc44303a9014606"/><title data-react-helmet="true">Using dynamic portals in React to “play nice with” autoplay policy | Helixbassment</title><meta data-react-helmet="true" name="description" content="The problemOn the current project, we have a video inside a “lightbox”-style modal. We got design feedback that it would be nice
for the video to autoplay when…"/><meta data-react-helmet="true" property="og:title" content="Using dynamic portals in React to “play nice with” autoplay policy"/><meta data-react-helmet="true" property="og:description" content="The problemOn the current project, we have a video inside a “lightbox”-style modal. We got design feedback that it would be nice
for the video to autoplay when…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Julian Rosse"/><meta data-react-helmet="true" name="twitter:title" content="Using dynamic portals in React to “play nice with” autoplay policy"/><meta data-react-helmet="true" name="twitter:description" content="The problemOn the current project, we have a video inside a “lightbox”-style modal. We got design feedback that it would be nice
for the video to autoplay when…"/><style data-href="/blog/styles.a44e04c81c870fbe590c.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/blog/static/montserrat-latin-100-4124805c0503dbfe42dd67d7f5715964.woff2) format("woff2"),url(/blog/static/montserrat-latin-100-c8fb2f714bbc7bc3e8dfffa916b286dc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/blog/static/montserrat-latin-100italic-e4bf47bd171a9b2a72dd84c58bf90edf.woff2) format("woff2"),url(/blog/static/montserrat-latin-100italic-d1f3f2d02ee4d7d2d4b1ad865014f189.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/blog/static/montserrat-latin-200-444ae007121264bc1969d49b4031f9b2.woff2) format("woff2"),url(/blog/static/montserrat-latin-200-edbce16a90aa22c297a0307b85789837.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/blog/static/montserrat-latin-200italic-f316c5d1ec40f3e68654c3f38b3999f3.woff2) format("woff2"),url(/blog/static/montserrat-latin-200italic-d7bbb730d9b5e11720b3eb32326dcca7.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/blog/static/montserrat-latin-300-0a7c6df06e85d978d096d4d18fd8d43d.woff2) format("woff2"),url(/blog/static/montserrat-latin-300-5e86df2cad22d2ef2b03516334afae5e.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/blog/static/montserrat-latin-300italic-c076c4892bc7a4be7b9097e97a35012d.woff2) format("woff2"),url(/blog/static/montserrat-latin-300italic-37c74a8d2d0d36a0a2c6e9a37ee15b0c.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/blog/static/montserrat-latin-400-501ce09c42716a2f6e1503a25eb174c9.woff2) format("woff2"),url(/blog/static/montserrat-latin-400-f29d2b8559699b6beb5b29b25b8bc572.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/blog/static/montserrat-latin-400italic-882908d9950d9c86ebd380877f293d95.woff2) format("woff2"),url(/blog/static/montserrat-latin-400italic-22e7b04e5f2a901d49d4d342315a715a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/blog/static/montserrat-latin-500-f0f2716c5fe401d175b88715e7d28685.woff2) format("woff2"),url(/blog/static/montserrat-latin-500-991b453bf90a0980e78966d2af7e3d3a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/blog/static/montserrat-latin-500italic-4590ebba421b3288c305305d7fa7b504.woff2) format("woff2"),url(/blog/static/montserrat-latin-500italic-f3d41e4cdcc2314e49ddcea751d6f87f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/blog/static/montserrat-latin-600-15c24f7109941777774ddd2c636c6a50.woff2) format("woff2"),url(/blog/static/montserrat-latin-600-f6dc6096f48956908c1787d9a722570a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/blog/static/montserrat-latin-600italic-6d10b80529d5c36c7c09fca7193af0fc.woff2) format("woff2"),url(/blog/static/montserrat-latin-600italic-02c4833312d94b1b0866f073023a250e.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/blog/static/montserrat-latin-700-79982cd1f74c6fa7451bf9b37ead09ff.woff2) format("woff2"),url(/blog/static/montserrat-latin-700-957e93fbbe131a59791cd820d98b7109.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/blog/static/montserrat-latin-700italic-283438e9577fe6a684466bb100e105ec.woff2) format("woff2"),url(/blog/static/montserrat-latin-700italic-ca627c5ccc65cf80c2ecaea44b997de9.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/blog/static/montserrat-latin-800-35386154b78d046218fc8f88a44ff515.woff2) format("woff2"),url(/blog/static/montserrat-latin-800-756655905d91b77960888262e7d58d35.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/blog/static/montserrat-latin-800italic-e1b52a7bd83e2324db6d92bdc206844c.woff2) format("woff2"),url(/blog/static/montserrat-latin-800italic-a69f0add9d86c1a84311d7dd8693ba4a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/blog/static/montserrat-latin-900-260c2ea3ef57feb82251952e605a36d5.woff2) format("woff2"),url(/blog/static/montserrat-latin-900-186cae8091da578150d81958e217714a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/blog/static/montserrat-latin-900italic-d785fb9fc74588ffb7f306799709a97d.woff2) format("woff2"),url(/blog/static/montserrat-latin-900italic-43b527fe77254f97ea36e2b54e845ec4.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/blog/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/blog/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/blog/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/blog/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/blog/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/blog/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/blog/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/blog/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/blog/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/blog/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/blog/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/blog/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/blog/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/blog/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/blog/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/blog/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}</style><link as="script" rel="preload" href="/blog/component---src-templates-blog-post-js-7ac9cc2b2308ecba134b.js"/><link as="script" rel="preload" href="/blog/0-cf1734d1d359fd97ae40.js"/><link as="script" rel="preload" href="/blog/app-cb4a8d22fe4321238c1c.js"/><link as="script" rel="preload" href="/blog/styles-5aff52f01899f63c8b09.js"/><link as="script" rel="preload" href="/blog/webpack-runtime-85cf0dd4b14bbc6d38e1.js"/><link as="fetch" rel="preload" href="/blog/static/d/936/path---dynamic-portal-61-d-706-weD3WM4rUqLmVqDVtFsrM2Iu1k.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/blog/">Helixbassment</a></h3></header><main><h1>Using dynamic portals in React to “play nice with” autoplay policy</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.75rem">June 09, 2019</p><div><h3>The problem</h3>
<p>On the current project, we have a video inside a “lightbox”-style modal. We got design feedback that it would be nice
for the video to autoplay when the modal is opened</p>
<p>However, by default when setting the video to autoplay, it was playing muted in Safari/iOS Safari (requiring an additional
tap to unmute). Since iPad is the primary deployment target for this project and the design feedback was that it should only
autoplay if it can play unmuted, we decided to try and figure out a way to achieve that</p>
<p>We felt like in theory it should be doable since even though browsers have been tightening up their autoplay policies, there
has to be a way to play a video unmuted based on explicit user action, and here there was an explicit user action taking place
before playing the video (clicking to open the modal)</p>
<p>So <a href="https://github.com/amay">Alex</a> figured that (from a React perspective) effectively if the video were already mounted
before the modal was opened and then we did something more like an imperative <code class="language-text">.play()</code> command when the modal was opened,
it was likely that the video would play unmuted</p>
<h3>The obstacle</h3>
<p>If the modal itself could be mounted “up front” and simply kept visually hidden (via CSS) until it was toggled open, that
would be straightforward, as the video component inside the modal would also be pre-mounted along with the modal itself</p>
<p>However, on this project we’re using <a href="https://react-bootstrap.github.io/"><code class="language-text">react-bootstrap</code></a>, which states in its <a href="https://react-bootstrap.github.io/components/modal/"><code class="language-text">Modal</code>
docs</a> that “Modals are <em>unmounted</em> when closed”</p>
<p>And it didn’t seem viable to try and use a different type of modal just for this particular instance</p>
<p>So the only option for having the video pre-mounted before the modal opened seemed to be to somehow mount it somewhere and
then “move” it to inside the modal once the modal had mounted</p>
<h3>Portals to the rescue?</h3>
<p>The React-y way to achieve that would be with a <a href="https://reactjs.org/docs/portals.html">portal</a>. If you haven’t seen React
portals before, basically they allow you to render something inside any arbitrary DOM node (rather than inside its React
parent)</p>
<p>I had never seen a “dynamic portal” that changed its target parent DOM node “mid-flight”, but that seemed like
the most obvious way to structure it - mount the video inside some visually hidden parent container initially (via a portal)
and then when the modal opened, <em>\</em>poof** change the portal destination to the modal!</p>
<h3>tl;dr it worked</h3>
<p>Using this dynamic portal to premount the video, it did in fact play unmuted in Safari!</p>
<h3>The code</h3>
<p>So let’s look at the specific code patterns used to create this “dynamic portal”</p>
<p>Portals expect to be given an actual DOM node (for the destination). So in React, when you hear “actual DOM node” you should
be thinking “ref”</p>
<p>Here, we need two refs since we need two DOM nodes for the portal destination - a visually hidden container and then the modal</p>
<p>Initially I tried using <a href="https://reactjs.org/docs/refs-and-the-dom.html#creating-refs">“new-style refs”</a>, since these days I’d
default to using that style of ref. But I wasn’t seeing the portal rerendering reliably once the refs were populated</p>
<p>This was new to me, but apparently that’s known/expected behavior when using new-style refs via the <a href="https://reactjs.org/docs/hooks-reference.html#useref"><code class="language-text">useRef</code> hook</a>
and if you need to trigger rerendering based on a ref changing, you need to use <a href="https://reactjs.org/docs/hooks-faq.html#how-can-i-measure-a-dom-node">callback-style refs</a>
instead</p>
<p>So here’s how I wired up the two callback-style refs:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">import {flow} from &#39;lodash/fp&#39;

const VideoAnswer = flow(
  ...
  addCallbackRefAndNode(
    &#39;lightboxPortalTargetCallbackRef&#39;,
    &#39;lightboxPortalTargetNode&#39;
  ),
  addCallbackRefAndNode(
    &#39;visuallyHiddenVideoContainerCallbackRef&#39;,
    &#39;visuallyHiddenVideoContainerNode&#39;
  ),
  ...
  ({
    ...
    lightboxPortalTargetCallbackRef,
    visuallyHiddenVideoContainerCallbackRef,
    ...
  }) =&gt;
    ...
      &lt;div
        css={a11yStyles.visuallyHidden}
        aria-hidden=&quot;true&quot;
        ref={visuallyHiddenVideoContainerCallbackRef}
      /&gt;
      &lt;Lightbox
        ...
        childPortalTargetRef={lightboxPortalTargetCallbackRef}
      /&gt;
    ...
)</code></pre></div>
<p>First of all, this is an <a href="https://github.com/helixbass/ad-hok"><code class="language-text">ad-hok</code></a>-style component using <a href="https://simonsmith.io/dipping-a-toe-into-functional-js-with-lodash-fp#compose-yourself"><code class="language-text">flow()</code></a>.
<code class="language-text">ad-hok</code> is allowing us to build up component functionality in a highly composable way similar to <a href="https://github.com/acdlite/recompose">Recompose</a>,
but where you’re using React hooks instead of higher-order components as your building blocks</p>
<p><code class="language-text">addCallbackRefAndNode()</code> is a helper for exposing a callback-style ref and the node it references:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">import {flow} from &#39;lodash/fp&#39;
import {upperFirst} from &#39;lodash&#39;
import {addState, addCallback} from &#39;ad-hok&#39;

const addCallbackRefAndNode = flow(
  (refPropName, nodePropName) =&gt; ({
    refPropName,
    nodePropName,
    setNodePropName: `set${upperFirst(nodePropName)}`,
  }),
  ({refPropName, nodePropName, setNodePropName}) =&gt;
    flow(
      addState(nodePropName, setNodePropName),
      addCallback(
        refPropName,
        ({[setNodePropName]: setNode}) =&gt; node =&gt; {
          setNode(node)
        },
        []
      )
    )
)</code></pre></div>
<p>Here, <code class="language-text">addState()</code> and <code class="language-text">addCallback()</code> are <code class="language-text">ad-hok</code> helpers that wrap the <code class="language-text">useState()</code> and <code class="language-text">useCallback()</code> hooks, respectively.
So <code class="language-text">addCallbackRefAndNode()</code> is encapsulating a state variable for the callback ref to assign the DOM node reference to</p>
<p>And the <code class="language-text">childPortalTargetRef</code> is a new prop I added to our <code class="language-text">&lt;Lightbox&gt;</code> component to allow wiring up the ref to the modal body:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">const Lightbox = ({
  ...
  childPortalTargetRef,
}) =&gt; (
  &lt;Modal
    ...
  &gt;
    &lt;Modal.Body
      ...
      ref={childPortalTargetRef}
    &gt;
      ...
    &lt;/Modal.Body&gt;
  &lt;/Modal&gt;
)</code></pre></div>
<p>So that takes care of getting references to the two DOM nodes we need</p>
<p>Then we want to dynamically change which one the portal uses as its destination based on whether the modal is open:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">      &lt;Portal
        to={showingModal ? lightboxPortalTargetNode : visuallyHiddenVideoContainerNode}
      &gt;
        &lt;Video
          ...
          playing={showingModal}
        /&gt;
      &lt;/Portal&gt;</code></pre></div>
<p>where <code class="language-text">&lt;Portal&gt;</code> is just a simple wrapper around <code class="language-text">React.createPortal()</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">import {createPortal} from &#39;react-dom&#39;
import {flowMax, branch, renderNothing} from &#39;ad-hok&#39;

import {childrenPropType, domNodePropType} from &#39;util/propTypes&#39;

const Portal = flowMax(
  branch(({to}) =&gt; !to, renderNothing()),
  ({to, children}) =&gt; createPortal(children, to)
)

Portal.propTypes = {
  to: domNodePropType,
  children: childrenPropType.isRequired,
}</code></pre></div>
<p>That’s the gist of the dynamic portal implementation</p>
<p>For completeness’ sake, I also ran into a little weird behavior in Chrome: for some reason when the modal was closed, the
video’s audio was restarting and continuing to play (rather than the video stopping when the modal closed). We’re using
<a href="https://www.npmjs.com/package/react-player"><code class="language-text">react-player</code></a> as an abstraction around the actual HTML5 <code class="language-text">&lt;video&gt;</code> inside our
<code class="language-text">&lt;Video&gt;</code> component, so it’s possible its internal state got wonky. But regardless, we can seize control of the situation by
making sure the video is fully unmounted after the modal has been closed</p>
<p>First, set up a <code class="language-text">hasModalBeenClosed</code> state variable:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">import {..., addStateHandlers} from &#39;ad-hok&#39;

const addVideoUnmountingOnModalClose = flow(
  addStateHandlers(
    {hasModalBeenClosed: false},
    {
      onModalClose: () =&gt; () =&gt; ({
        hasModalBeenClosed: true,
      }),
    }
  ),
  addEffectOnPropChange(
    [&#39;showingModal&#39;],
    ({showingModal, onModalClose}, prevProps) =&gt; {
      if (!showingModal &amp;&amp; prevProps.showingModal) {
        onModalClose()
      }
    }
  )
)</code></pre></div>
<p>This uses the handy <a href="./addEffectOnPropChange"><code class="language-text">addEffectOnPropChange()</code> helper</a></p>
<p>And then we’ll consider the value of <code class="language-text">hasModalBeenClosed</code> when deciding what the portal destination should be</p>
<p>Putting it all together:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">const addVideoUnmountingOnModalClose = flow(
  addStateHandlers(
    {hasModalBeenClosed: false},
    {
      onModalClose: () =&gt; () =&gt; ({
        hasModalBeenClosed: true,
      }),
    }
  ),
  addEffectOnPropChange(
    [&#39;showingModal&#39;],
    ({showingModal, onModalClose}, prevProps) =&gt; {
      if (!showingModal &amp;&amp; prevProps.showingModal) {
        onModalClose()
      }
    }
  )
)

const getVideoPortalTarget = ({
  showingModal,
  lightboxPortalTargetNode,
  hasModalBeenClosed,
  visuallyHiddenVideoContainerNode,
}) =&gt; {
  if (showingModal) return lightboxPortalTargetNode
  if (hasModalBeenClosed) return null
  return visuallyHiddenVideoContainerNode
}

const VideoAnswer = flow(
  ...
  addState(&#39;showingModal&#39;, &#39;setShowingModal&#39;, false),
  addCallbackRefAndNode(
    &#39;lightboxPortalTargetCallbackRef&#39;,
    &#39;lightboxPortalTargetNode&#39;
  ),
  addCallbackRefAndNode(
    &#39;visuallyHiddenVideoContainerCallbackRef&#39;,
    &#39;visuallyHiddenVideoContainerNode&#39;
  ),
  addVideoUnmountingOnModalClose,
  ({
    ...
    showingModal,
    lightboxPortalTargetCallbackRef,
    lightboxPortalTargetNode,
    visuallyHiddenVideoContainerCallbackRef,
    visuallyHiddenVideoContainerNode,
    hasModalBeenClosed,
  }) =&gt; (
    &lt;&gt;
      ...
      &lt;div
        css={a11yStyles.visuallyHidden}
        aria-hidden=&quot;true&quot;
        ref={visuallyHiddenVideoContainerCallbackRef}
      /&gt;
      &lt;Portal
        to={getVideoPortalTarget({
          showingModal,
          lightboxPortalTargetNode,
          hasModalBeenClosed,
          visuallyHiddenVideoContainerNode,
        })}
      &gt;
        &lt;Video
          ...
          playing={showingModal}
        /&gt;
        ...
      &lt;/Portal&gt;
      &lt;Lightbox
        show={showingModal}
        ...
        childPortalTargetRef={lightboxPortalTargetCallbackRef}
      /&gt;
    &lt;/&gt;
  )
)</code></pre></div>
<h4>Unresolved: a11y</h4>
<p>This pattern seems to have achieved the desired behavior of getting unmuted autoplay to work cross-browser. But there’s an
outstanding accessibility issue with it that I’m not sure if there’s a great solution to:</p>
<p>When the video is initially mounted inside the visually-hidden container, it’s hidden from screen readers using
<code class="language-text">aria-hidden=&quot;true&quot;</code>. But it’s still keyboard-navigable (ie you can hit Tab and it will focus on the interactive elements of
the video component while it’s offscreen)</p>
<p>I tried using the HTML5 <code class="language-text">hidden</code> attribute instead of <code class="language-text">aria-hidden=&quot;true&quot;</code>, but that reverted the autoplay muted behavior</p>
<p>So I’m not sure if there’s a general a11y technique for making all interactive elements under a given parent container element
non-keyboard-navigable?</p>
<p>Regardless, I think in this case achieving the desired autoplay behavior on the target iPad platform outweighs the potentially
confusing keyboard navigation. But it would be nice to cover our bases a11y-wise especially when thinking about reusing this
technique in the future</p></div><hr style="margin-bottom:1.75rem"/><div style="display:flex;margin-bottom:4.375rem"><p>Written by <strong>Julian Rosse</strong> who lives and works in NYC.</p></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/blog/useeffectonpropchange/">← <!-- -->Handy React hooks helper: useEffectOnPropChange()</a></li><li></li></ul></main><footer>© <!-- -->2019<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'undefined', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"dynamic-portal-61d","path":"/dynamic-portal/"};window.dataPath="936/path---dynamic-portal-61-d-706-weD3WM4rUqLmVqDVtFsrM2Iu1k";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-cb4a8d22fe4321238c1c.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-78f9e4dea04737fa062d.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-7ac9cc2b2308ecba134b.js"],"component---src-pages-404-js":["/component---src-pages-404-js-e9b9f6e922157fa3e443.js"],"component---src-pages-index-js":["/component---src-pages-index-js-7ff1b64d75db47a14a88.js"],"pages-manifest":["/pages-manifest-fab0e84324aa4613309b.js"]};/*]]>*/</script><script src="/blog/webpack-runtime-85cf0dd4b14bbc6d38e1.js" async=""></script><script src="/blog/styles-5aff52f01899f63c8b09.js" async=""></script><script src="/blog/app-cb4a8d22fe4321238c1c.js" async=""></script><script src="/blog/0-cf1734d1d359fd97ae40.js" async=""></script><script src="/blog/component---src-templates-blog-post-js-7ac9cc2b2308ecba134b.js" async=""></script></body></html>